---
title: Food-web structure, stochasticity and response diversity drive temporal community stability in complex communities
author: "Alain Danet (1), Sonia Kéfi (2,3), Thomas F Johnson (1), Andrew P. Beckerman (1)"
date: ""
output:
  officedown::rdocx_document:
    number_sections: false
    base_format: "bookdown::word_document2"
  bookdown::pdf_document2:
    latex_engine: xelatex
    keep_tex: true
    spacing: double
    number_sections: false
always_allow_html: true
bibliography: references.bib
link-citations: true
#csl: nature.csl
csl: ecology-letters.csl
toc: false
linestretch: 2.0
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
  - \usepackage{hyperref}
  - \hypersetup{backref=true}
  - \usepackage{setspace}\doublespacing
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  cache = FALSE,
  collapse = TRUE,
  comment = "#>",
  fig.pos = "H",  # pdf mode
  #fig.dim = c(7, 7),
  fig.fullwidth = TRUE,
  fig.show = "hold",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  results = TRUE,
  fig.path="figures/"
)
```

```{r, results = FALSE}
sapply(c("targets", "tidyverse", "magrittr", "cowplot", "here", "piecewiseSEM",
    "semEff", "ggcorrplot", "kableExtra", "rmarkdown", "officedown"),
  require,
  character.only = TRUE)
mytheme <- theme_cowplot(font_size = 8) +
background_grid() +
theme(legend.position = "bottom")
theme_set(mytheme)
sapply(list.files(here("R"), full.names = TRUE), source)
```

- 1 School of Biosciences, Ecology and Evolutionary Biology, University of Sheffield, Western Bank, Sheffield, S10 2TN, UK
- 2 ISEM, CNRS, Univ. Montpellier, IRD, EPHE, Montpellier, France
- 3 Santa Fe Institute, 1399 Hyde Park Road, Santa Fe, NM 87501, USA

---
## IDEA:
# Talk about about how stochasticity minor interaction effects similar to
# dispersal (Holt, 1985; other papers I guess)
---

- Putative titles:
  - Community stability is driven by biodiversity and response diversity in
    complex stochastic food-webs
  - Response diversity and community structure drive community stability in
    complex food-webs

- Two strong results:
  - Community stability raises primary from richness and average trophic level
    but average interaction strength and connectance have little effects
  - Response diversity and community structure interact strongly to determine
    the sign of the relationship between community stability and species
    richness

# Abstract (150/150 words)

[NOT CHANGED] Empirical and theoretical evidence suggests environmental changes will
dramatically destabilise ecological communities. However, this evidence is
largely based on oversimplified communities, which lack the complexity of
natural communities. We characterise the dynamics of complex food-webs under a
stochastic food-web model, and investigate how response diversity,
stochasticity, and food-web structure drive temporal stability. We found that
higher average trophic level increased community stability by increasing
population stability, at the expense of asynchrony. Species richness had little
effect on population stability, but a large one on asynchrony. Interaction
strength and connectance had little effects on temporal stability overall, but
interacted strongly with response diversity to determine stability-richness
relationships. Absence of response diversity all leaded to negative
stability-richness relationships, but high response diversity resulted in high
prevalence of positive stability-richness relationships. Our study reveals that
response diversity and food-web structure drive temporal stability overall, and
together determine the sign of the stability-richness relationship.


# Introduction

Ever-growing anthropogenic pressures have resulted in alteration of biodiversity
[@newbold_global_2015; @services_summary_2019], community changes
[@dornelas_assemblage_2014], and climate change will result in dramatic
environmental fluctuations [@lee_ipcc_2023]. How ecological communities will
respond to those threats is then a pressing, but challenging question
[@simmons_refocusing_2021; @yang_predictability_2019]. The temporal stability of
ecological communities is an emerging property that indeed results of the
complex interplay between anthropogenic pressures [@olivier_urbanization_2020;
@hautier_anthropogenic_2015; @yang_predictability_2019], community size
[@tilman_biodiversity_2006; @isbell_biodiversity_2009;
@olivier_urbanization_2020; @pennekamp_biodiversity_2018] and community
structure [@thebault_trophic_2005; @thebault_relationship_2006;
@thibaut_understanding_2013; @danet_species_2021;
@eschenbrenner_diversity_2023].

Understanding emerging temporal community stability (hereafter referred to as
community stability) requires scaling down the focus to population scale
[@doak_statistical_1998; @thibaut_understanding_2013; @zhao_biodiversity_2022].
Community stability can be partitioned into average population
stability and asynchrony [@loreau_species_2008; @thibaut_understanding_2013;
@zhao_biodiversity_2022], asynchrony measuring how much population
fluctuations’ are compensating at the community level. The question of how
global change will respectively affect population stability and asynchrony is
still open.

Asynchrony among species is the central pattern that drive the positive
community stability-diversity relation documented across many species assemblages
[@tilman_biodiversity_2006; @olivier_urbanization_2020;
@pennekamp_biodiversity_2018]. Asynchrony does not emerge by species richness
itself, but by its interplay with response diversity of species to perturbations
[@elmqvist_response_2003; @loreau_species_2008; @ives_stability_2000;
@ross_how_2023], and compensatory dynamics raising from species interactions.
Asynchrony can then stem from statistical averaging of independent species
fluctuations ["portfolio effects", @doak_statistical_1998;
@tilman_ecological_1999] or compensatory dynamics resulting from response
diversity and species interactions [@zhao_biodiversity_2022]. Among other
reasons, it might explain why reports of neutral or negative stability-richness
relationships are also common in empirical settings [@houlahan_negative_2018].
However, most of our knowledge comes from simplified community
structure, i.e. which does not account for the multiple trophic
levels constituting ecological communities [but see @danet_species_2021;
@thebault_trophic_2005; @ives_stability_2007; @eschenbrenner_diversity_2023],
thereby limiting our understanding of the drivers of both community stability
and stability-richness relationships in more complex communities.

The structure of community also shapes communities
[@macarthur_fluctuations_1955; @may_will_1972; @angelis_stability_1975;
@mccann_weak_1998; @vasseur_environmental_2007; @thebault_trophic_2005], such as
the strength [@may_will_1972; @mccann_weak_1998; @thebault_trophic_2005] and
distribution [@may_will_1972; @angelis_stability_1975; @mccann_weak_1998;
@mccann_reevaluating_1997] of species interactions determine population
stability and stability-richness relationship [two trophic level systems,
@thebault_trophic_2005; @ives_stability_2007], while the number of trophic
levels determine population stability [@shanafelt_stability_2018]. Community
structure also interact with response diversity to population stability in
diamond shaped food-webs [@ripa_food_2003; @vasseur_environmental_2007;
@ruokolainen_environmental_2013]. However, the work on community structure
lacked the complexity in terms of species richness or trophic levels, and
focused more on population stability than on asynchrony.

Then, the two body of work focusing on the effects of (1) species richness or
the effects of (2) community structure on community stability have been
developed in isolation. While (1) highlighted the importance of asynchrony
stemming response diversity ("insurance hypothesis"), (2) highlighted the
importance of population stability arising from species interactions (top-down
and bottom-up controls). Two keys advances allow to overcome that limitation:
the development of the Bioenergenetic model that enable to model arbitrary
complex communities [@yodzis_body_1992; @brose_allometric_2006] and the
development of statistical tools that enables to partition community stability
into population stability and asynchrony [@thibaut_understanding_2013;
@zhao_biodiversity_2022].

Here, we investigated the effects of species richness and community structure on
community stability and on stability-richness relationship in complex stochastic
food-web. To do so, we developed an extension of the Bioenergetic model
[@brose_allometric_2006; @lajaaiti_ecologicalnetworksdynamicsjl_2024] which
includes environmental stochasticity and response diversity
[@vasseur_environmental_2007]. We modelled food-web varying in size (species
richness XX) and structure (Connectance XX, Predator-Prey Mass Ratio: XX) to
create a diversity of community structure. We additionally varied the
variability of environmental stochasticity (standard deviation of mortality
rates) and response diversity ($1-\rho$, $\rho$ being the correlation among
species mortality rates). We performed XXXXX simulations over a minimum 2000
timesteps (Table S1) and collected the 500 last timesteps to compute community
stability and structure. Using a structural equation model, we deciphered the
ways in which stressors (environmental stochasticity, decreasing response
diversity) and community structure (species richness, average interaction
strength, average trophic level, connectance) determine community stability. In
a second time, we used a linear model to investigate how community structure
interact with response diversity to determine the sign of the stability-richness
relationship.

---
#Here we deliver inference from modelling of complex biodiverse communities on
#how food-web structure (connectance, average interaction strength, average
#trophic level), response diversity, and environmental stochasticity combine to
#shape temporal stability of community biomass, as well as its partition into
#asynchrony and population stability. We then assess how food-web complexity and
#response diversity shape stability-richness relationships.

#Environmental forcing (such as food availability and
#warming) and land-use intensity was reported to synchronise population
#fluctuations [@benton_population_2001; @bluthgen_land_2016; @song_reduced_2015;
#@liu_aridity_2023] while habitat degradation tends to decrease population
#stability [@olivier_urbanization_2020]. Understanding the effects of global
#change on community temporal stability therefore require to account for their
#simultaneous effects on community and population scales [@kefi_advancing_2019;
#@simmons_refocusing_2021].

#Increasing species richness has been reported to decrease population stability
#in experimental grasslands [@tilman_biodiversity_2006;
#@roscher_identifying_2011], while increasing population stability in natural
#settings [@houlahan_negative_2018] [add mechanisms?]. In turn, higher species
#richness often results in higher asynchrony, through portfolio effects (i.e.
#statistical averaging effects due to independent species fluctuations) and
#compensatory dynamics (due to species interactions and response diversity of
#species due to the environment) [@loreau_species_2008;
#@thibaut_understanding_2013]. Systematic increase in asynchrony with species
#richness is the mechanism that drives reported positive relationships between
#community stability and species richness [ref]. Anthropogenic pressures, such as
#eutrophication, has been reported to weakens the relationship between species
#richness and asynchrony in grasslands [@hautier_eutrophication_2014] but such
#empirical evidence remains scarce. However, stressors such as biotic
#homogenization [@buisson_toward_2013; @muthukrishnan_invasive_2020;
#@saladin_rapid_2020] and environmental forcing that decrease species response
#diversity should dampens the relationships between asynchrony and species
#richness [@ives_stability_2000; @thibaut_understanding_2013] due to a decrease
#in portfolio effects and compensatory effects. [Talk about the effects of
#evenness in temporal variability and evenness in abundance? e.g.,
#@zhao_biodiversity_2022; @thibaut_understanding_2013]. Because stressors can
#affect both community stability per se and how community stability scales with
#species richness, improving our understanding require to study both
#[@ives_stability_2007; @hautier_anthropogenic_2015].

#including levels of generalism, the distribution of interaction strengths and
#the prevalence of omnivory, can also influence stability. The degree of
#generalism of predator was shown to modulate stability-richness relationships
#[@thebault_trophic_2005], and generalist predators can synchronise the dynamics
#of their preys[@raimondo_interspecific_2004]. The strength and distribution of
#interaction strength was also shown to be strong driver of community stability,
#such as stronger interaction strengths can be destabilizing [@may_will_1972;
#@mccann_weak_1998]. Omnivory was also shown to drive higher population stability
#[@mccann_reevaluating_1997]. The effects of food-web structure on ecosystem
#stability has been mostly assessed with small modules [but see
#@eschenbrenner_diversity_nodate], and we know very little how food-web structure
#affects the relationships between species richness and temporal stability in
#complex food-webs. So understanding the effects of stressors on community
#stability and on community stability-richness relationships necessitate to
#account for food-web structure.
---

# Methods

## Bioenergenetic model

We simulated the dynamics of complex food-webs using the allometric bioenergetic
model [@yodzis_body_1992; @brose_allometric_2006; @delmas_simulations_2017]. This model
is widely used to simulate the dynamics of complex ecological communities
because of the simplicity  and because it can be parametrized using  the
metabolic theory of ecology [@brown_toward_2004]. The model describes species
biomass dynamics over time with two master equations (eq. \@ref(eq:dbdt)), one
for the primary producers (eq. \@ref(eq:prod)) and one for the consumers (eq.
\@ref(eq:prod)):

\begin{subequations}
    \label{eq:dbdt}

    \begin{equation}
        \label{eq:cons}
        \frac{dB_i}{dt} =
        \sum_{j \in \{\mathrm{res}\}_i} x_i y_i B_k F_{ij}
        - \sum_{j \in \{\mathrm{cons}\}_i} \frac{x_j y_j B_j F_{ji}}{e_{ij}}
        - x_i B_i - d_i B_i
    \end{equation}

    \begin{equation}
    	\label{eq:prod}
    	\frac{dB_i}{dt} =
	r_i B_i G_i
	- \sum_{j \in \{\mathrm{cons}\}_i} \frac{x_j y_j B_j F_{ji}}{e_{ij}}
        - d_i B_i
    \end{equation}
\end{subequations}


The consumers gain biomass by consuming resources (i.e. their preys) at a rate
that depends on their mass specific metabolic rate ($x_i$),  maximum consumption
rate ($y_i$) and on the functional response ($F_ij$) describing how the rate of
consumption of a consumer $i$ on a resource $j$ vary with the biomass of this resource.
Consumers then lose biomass by being consumed, $e_ij$ being the assimilation
efficiency of the consumer $j$ on the resource $i$. Consumers also lose biomass
over time through metabolic losses ($-x_iB_i$) and by natural mortality due to
environment ($-d_iB_i$). The primary producers gain biomass over time with a
growth rate ($r_i$, eq. \@ref(eq:prod)) and a functional response ($G_i$)
describing how the growth of the producers vary with their biomass. They lose
biomass by being consumed by consumers and by natural mortality.

\begin{subequations}
    \label{eq:func}
    \begin{equation}
        \label{eq:growth}
        G_i = (1 - \dfrac{\sum_{j \in \{\mathrm{prod}\}} \alpha_{ij} B_j}{K_i})
    \end{equation}

    \begin{equation}
    	\label{eq:holling}
        F_{ij} = \frac{\omega_{ij} B_j^h}
        {B_0^h + c_i B_i
        	+ \sum_{k \in \{\mathrm{res}\}_i} \omega_{ik} B_k^h}
    \end{equation}
\end{subequations}


The growth of the primary producers (eq. \@ref(eq:growth)) is logistic
where the growth rate is maximal and null when
$\sum_{j \in \{\mathrm{prod}\}} \alpha_{ij} B_j$ are respectively close to 0 and 1. $\alpha_{ij}$ is the
per capita effect of the producer $j$ on the producer $i$, $K_i$ being the
carrying capacity for the producer $j$. The functional response of a consumer
feeding on a resource (eq. \@ref(eq:holling)) depends on the relative preference
of the consumer on the resource ($\omega_ij$) is limited by a half-saturation
rate ($B_0$), intraspecific interference coefficient ($c_i$), and on the
availability of its other resources
($\sum_{k \in \{\mathrm{res}\}_i} \omega_{ik} B_k^h$). Finally, the $h$ exponent
controls the shape of the functional response from a saturating function
($h = 1$, Holling type II) to a sigmoid ($h = 2$, Holling type III).

## Environmental stochasticity and response diversity

We added a stochastic natural mortality rate to the species dynamics,
representing a fluctuating environment. Based on the literature and previous
models [@vasseur_environmental_2007], we assumed that natural mortality rates
scales inversely with the species body mass ($d_i = d_0M_i^{-1/4}$), as all
other physiological parameters. We used a basal natural mortality rate of $d_0 =
.4$, as done in previous studies[@vasseur_environmental_2007].

We introduced environmental stochasticity by considering stochastic variation of
mortality rates. Doing so allows to consider stochasticity without modifying
species interactions themselves
[@vasseur_environmental_2007]. The stochastic part of the mortality rates
($\epsilon_{i, t}$) follow a normal distribution 0 centered
($\epsilon_{i, t} \sim N(0,\sigma^2_e)$) with a variance ($\sigma^2_e$). The
mortality rates of each species at the time $t$ equals to $d_{i,t} = d_i
e^{\epsilon_{i, t}}$, which ensured that the mortality rates never become
negative [@vasseur_environmental_2007]. We
simulated $\epsilon$ using an Ornstein-Uhlenbeck process, which is a modified
Brownian motion where the stochastic values tend to come back to the central
value (i.e. $\epsilon = 0$) such as $\epsilon_t$ varies according to this
stochastic differential equation: $d\epsilon_t = (0 - \epsilon_t)d_t + \sigma_e
dW_t$, where $dW_t$ is a Brownian motion. The strength of environmental
stochasticity was then controlled by $\sigma_e$.

Response diversity was controlled by the correlation among species stochastic
mortality rates ($\rho_{ij, i \neq j}$) such as response diversity is maximal
when species mortality rates are uncorrelated ($\rho = 0$) and null when species
mortality rates are perfectly correlated ($\rho = 1$) [@ripa_food_2003;
@vasseur_environmental_2007; @gouhier_synchrony_2010]. So the species mortality
rates were a product of the stochastic mortality rates generated by the
Ornstein-Uhlenbeck process and a variance-covariance matrix such as:


\begin{equation}
\begin{aligned}
\epsilon_{i, t} =
  \begin{bmatrix}
     \rho_{11}\sigma^2_e & \rho_{12}\sigma^2_e & \cdots & \rho_{1n}\sigma^2_e \\
     \rho_{21}\sigma^2_e & \rho_{22}\sigma^2_e & \cdots & \rho_{2n}\sigma^2_e \\
     \vdots  & \vdots  & \ddots & \vdots  \\
     \rho_{n1}\sigma^2_e & \rho_{n2}\sigma^2_e & \cdots & \rho_{nn}\sigma^2_e
  \end{bmatrix}
  \begin{bmatrix}
     a_{1,t} \\
     a_{2,t} \\
     \vdots  \\
     a_{n,t}
  \end{bmatrix}
(\#eq:rho)
\end{aligned}
\end{equation}

Where $a_{i,t}$ the stochastic value generated by the Ornstein-Uhlenbeck process
at time $t$, $\rho_{ii} = 1.0$ while all $\rho_{ij, i \neq j}$ were equal and
control the level of response diversity.

## Simulation

```{r}
tar_load(sim_param_tab)
spt <- sim_param_tab
get_sim_par_val <- function(x = "S", data = sim_param_tab) {
  x <- data[data$Parameter == x,][c("min", "max", "n")]
  setNames(unlist(x), c("min", "max", "n"))

}
pS <- get_sim_par_val(x = "S")
pct <- round(get_sim_par_val(x = "ct"), 2)
pZ <- get_sim_par_val(x = "Z")
pc <- get_sim_par_val(x = "c")
pe <- get_sim_par_val(x = "env_stoch")
prd <- get_sim_par_val(x = "resp_div")
pr <- get_sim_par_val(x = "rho")
```
\pagebreak

```{r}
met_cap <- "Examples of stochastic food-web simulations. a, Simulations with low
and high response diversity. b, simulations with low and high predator-prey mass
ratio (upper and bottom panels), low and high species richness (left and right
  panels). The food-webs are displayed on the side with the node size
being proportional to the average species biomass across the simulation. We
also display the food-web structure and the stability metrics. Across all
simulations, $h = 2$, $\\sigma_e = .3$. Low and high response diversity were
respectively $\\rho = 1$ and $\\rho = 0$. Low and high PPMR were respectively 1
and 100." %>%
str_replace_all("\\s+", " ")
```

```{r met, fig.cap = met_cap}
knitr::include_graphics(here("report", "figures", "p_methods.pdf"))
```

We generated food-web structure using the niche model [@williams_simple_2000]
with an initial species richness from $`r pS["min"]`$ to $`r pS["max"]`$, and
connectance from $`r pct["min"]`$ to $`r pct["max"]`$ (Table S1). We generated
food-webs without cannibalistic links and discarded food-webs that contained
disconnected species.

We varied the strength of environmental stochasticity by varying $\sigma_e$ from
$`r pe["min"]`$ to $`r pe["max"]`$, the range of mortality rates observed in
protists [@vasseur_environmental_2007]. We decreased response diversity by
increasing $\rho$ from $`r pr["min"]`$ to $`r pr["max"]`$ (i.e. response
diversity being $1 - \rho$) (Fig. \@ref(fig:met)a).

To vary interaction strength and mortality rates (i.e. allometrically
scaled mortality rate $d$) in the community, we varied the Predator-Prey
Mass Ratio (PPMR) from $`r pZ["min"]`$ to $`r pZ["max"]`$ (Fig. \@ref(fig:met)b).
We set $h = 2$, i.e. a functional response of type III (eq. \@ref(eq:holling)),
and varied predator interference (i.e. from $c = `r pc["min"]`$ to
$c = `r pc["max"]`$, eq. \@ref(eq:holling)), as predator interference was shown
to have a tremendous role on population stability [@brose_allometric_2006]. We
set a global carrying capacity of $K' = 10$ to ensure that consumers were not
limited by the biomass input from primary producers. We standardised the
carrying capacity by the number of primary producers and by the interspecific
competition among producers to ensure that the effects of species richness on
temporal stability are not driven by the increase in the number of primary
producers, thereby trivially increase biomass input for consumers. We then
standardised $K'$ such as $K_i = \frac{1 + \alpha_{ij} (S - 1)}{S}K'$
[@ives_stability_2000]. However, we found that our results were not affected
when removing the standardisation of carrying capacity (Fig. S1).

We numerically solved the stochastic differential equation systems during 2000
timesteps and collected the last 500 timesteps, similarly to previous studies
[@brose_allometric_2006]. We set $d_t = .1$, and $d_t = .05$ when instability
was detected during the simulations due to stiff changes in biomass. We set
extinction threshold to $10^{-6}$ and if an extinction happened in the last 500
timesteps, we continued to run the simulation for another 1000 timesteps until
there was no extinction events during the last 500 timesteps. When we found
disconnected species at the end of the simulation (i.e. a primary producer
without consumer or a consumer without prey), we set their biomass to 0 and
re-run the simulation for another 1000 timesteps. Except in the case of
disconnected species, we re-ran simulations with species starting biomass equal
to their biomass at the last timestep of the previous simulation. Supplementary
analysis showed that alternative choices of simulation processes, such as longer
simulations, rebuilding food-webs (i.e. resetting consumer preferences,
recomputing species bodymass according to the new food-web) after removing
disconnected species did not affect our results (Fig. S1). The food-web
generation and simulations were done using the `Julia` package
`EcologicalNetworkDynamics.jl` [@lajaaiti_ecologicalnetworksdynamicsjl_2024].

## Simulation analysis

We measured food-web properties that have been linked with stability in the
literature.  We measured total biomass, species richness, connectance, average
trophic level weighted by biomass, average omnivory and average interaction
strength. Food-web properties were measured at each of the 500 timesteps and
then averaged, except connectance and trophic level that were static.
Connectance was computed as $C = L / S(S-1)$, $L$ being the number of trophic
links and $S$ being the number of species in the community. Species trophic
level was computed recursively from the bottom of the food-web, such as the
trophic level of a consumer was equal to the average trophic level of its
resources added to 1, the trophic level of primary producers being set to 1
[@christensen_ecopath_1992]. Average trophic level was then equal to:
$1/\hat{B}_i\sum_{i}\mathrm{TL}_i$, $\mathrm{TL}_i$ being the trophic level and
$\hat{B}_i$ the average biomass of the species $i$. The degree of omnivory of a
consumer was computed  such as the sum of squares of its resource trophic levels
weighted by the relative preference of the consumer for each resource: $\sum_i
(\mathrm{TL}_i - \hat{\mathrm{TL}})^2 \omega_i/ \sum \omega_i$
[@christensen_ecopath_1992]. Interaction strength was computed was quantified as
the biomass fluxes going from a resource to a consumer, such as: $I = x_i y_i
B_k F_{ij}$ (eq. \@ref(eq:cons)), and averaged over time. Our way of measuring
interaction strength is very similar to previous metrics used in previous
studies, at the difference here that we average fluxes over time and not the
maximal interaction strength [@mccann_weak_1998]. Finally, the average
interaction strength of a community was computed as the average interaction
strength at the exclusion of null interaction strengths (i.e. excluding absence
of trophic interactions).

We assessed the effects of food-web structure, environmental stochasticity and
response diversity on temporal stability of biomass. We measured temporal stability of biomass
as the inverse of the coefficient of variation. We further partitioned stability
into population stability ($S_{pop}$) and asynchrony ($\phi$) such as:

\begin{equation}
\begin{aligned}
S_{com} = S_{pop} \times \phi
(\#eq:scom)
\end{aligned}
\end{equation}

with $S_{com} = \mu_{tot} / \sigma_{tot}$, $S_{pop} = \mu_{tot} / \sum_i \sigma_i$,
$\phi = \sum_i \sigma_i / \sigma_{tot}$.

$\mu_{tot}$ and $\sigma_{tot}$ being respectively average total biomass and standard
deviation of total biomass.

To further get a mechanistic insight about the effects of stressors and food-web
structure on stability, we partitioned asynchrony into portfolio effects (measured by statistical averaging
effect, SAE) and compensatory dynamics effect (CPE) [@zhao_biodiversity_2022].
SAE quantities the portfolio effect emerging from independent species
fluctuations, while CPE describes compensatory dynamics deviating from portfolio
effects, and emerging from species interactions and differential responses to
environmental stochasticity.

\begin{equation}
\begin{aligned}
S_{com} = S_{pop} \times SAE \times CPE
(\#eq:scom2)
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
SAE = SAE_{even} \times EVN
(\#eq:sae)
\end{aligned}
\end{equation}

Statistical averaging effect is the share of asynchrony assuming that species are
independent, meaning that the variance total of the community is equal to the
sum of species variances only (i.e. species covariances are null). We can
define community stability ($S_{com, IP}$) in that scenario and then derive $SAE$.

\begin{equation}
\begin{aligned}
S_{com, IP} &= \dfrac{\mu_{tot}}{\sqrt{\sum_i \sigma^2_i}} = SAE \times S_{pop} \\
SAE &= \dfrac{S_{com, IP}}{S_{pop}} = \dfrac{\sum_i \sigma_i}{\sqrt{\sum_i \sigma^2_i}}\\
(\#eq:sae2)
\end{aligned}
\end{equation}

As SAE is further dependent on the evenness of species variance, we
partitioned $SAE$ into $SAE_{even}$ and evenness $EVN$, such as  $EVN = SAE / SAE_{even}$.
$SAE_{even}$ corresponds to the $SAE$ when species quantities are perfectly
even such as from eq. \@ref(eq:sae2), we can obtain $SAE_{even}$ from which
$EVN$ can be computed:

\begin{equation}
\begin{aligned}
SAE &= \dfrac{\sum_i \sigma_i}{\sqrt{\sum_i \sigma^2_i}} = \sqrt{\dfrac{1}{\sum_i (\sigma_i\sigma^2_i})^2} = \sqrt{\dfrac{1}{\sum_i (p_i)^2}}\\
SAE_{even} &= \sqrt{\dfrac{1}{\sum_i (1/S)^2}}\\
SAE_{even} &= \sqrt{S}\\
(\#eq:sae-even)
\end{aligned}
\end{equation}


Compensatory dynamics in the food-webs is then the remaining part of asynchrony:

\begin{equation}
\begin{aligned}
CPE &= \dfrac{S_{com}}{SAE \times S_{pop}} = \dfrac{\sqrt{\sum_i \sigma^2_i}}{\sigma_{tot}}\\
(\#eq:cpe)
\end{aligned}
\end{equation}

Compensatory dynamics can arise from predator-prey interactions
($CPE_{int}$) or from differential response of species to environmental
stochasticity ($CPE_{env}$). From the deterministic and stochastic parts of
mortality rates, we computed the compensatory dynamics linked to the environment
such as:

\begin{equation}
\begin{aligned}
CPE_{env} = \mathbf{B} \times \mathrm{diag}(d_i) \times e^\mathbf{E}
(\#eq:cpenv)
\end{aligned}
\end{equation}

With $\mathbf{B}$ and $\mathbf{E}$ being the matrices time x species for species biomass
and stochastic mortality rates respectively. Then compensatory dynamics raising
from species interactions were computed as: $CPE_{int} = CPE / CPE_{env}$.

## Statistical analysis

Using a structural equation model, we disentangled the complex effects of
food-web structure, environmental stochasticity and response diversity on the
different facets of temporal stability of biomass (i.e. population stability,
portfolio effects and compensatory dynamic effects). We tested the
effects of food-web structure (average interaction strength, average trophic
level, connectance) on population stability and asynchrony partitions (portfolio and
compensatory effects). Grounded in theoretical ecology, we expected that higher
average trophic level, lower interaction strength, lower connectance[@mccann_weak_1998;
@mccann_reevaluating_1997; @shanafelt_stability_2018]. We further added
simulation parameters as control variables because higher Predator-Prey Mass
Ratio and predator interference were also expected to increase population
stability [@brose_allometric_2006]. Finally, we tested the effects of environmental
stochasticity and response diversity on population stability and asynchrony
partitions, although there were predicted to mainly affect to population stability
(i.e. by increasing amplitude of population fluctuations) and asynchrony (i.e.
by generating independent population fluctuations) respectively. We
completed the structural equation model with the mathematical relationship
linking compensatory dynamics and statistical averaging effects to asynchrony,
and from asynchrony and population stability to community stability. We further
developed a more detailled SEM including the effects omnivory and partition of
compensatory dynamics due to species interactions ($CPE_{int}$) and due to
environmental fluctuations ($CPE_{env}$).

Prior to test the structural equation model, we logged all the stability
components to transform their relation from multiplicative to additive (eq.
\@ref(eq:scom2)). We ensured that all the linear models composing the structural
equation model presented low multicollinearity (Variance Inflation
Factor < 3, Table S2), although interaction strength and species richness were
highly correlated (Fig. S2). The structural equation model using the R package
`PiecewiseSEM` [@lefcheck_piecewisesem_2016]. We then bootstrapped (N = 100) the
SEM to obtain confidence intervals on the estimated effects and computed the sum
of the direct and indirect effects using `semEff` R package
[@murphy_semeff_2021]. In the main text, we reported standardised coefficients
which were obtained by scaling the coefficients by the standard deviation of the
response and predictor variable. Finally, we reported only the direct
standardised coefficients that had an absolute value above $0.05$, because
almost all linked were statistically significant given the high numbers of
simulations.

In a second analysis, we aimed to test how stability-species richness
relationships were modulated by food-web structure and the two stressors:
environmental stochasticity and response diversity. We then modelled temporal
stability of community biomass according to food-web structure: species
richness, weighted average trophic level, connectance and average interaction
strength, as well as environmental stochasticity and species response diversity.
We further included the two-way interactions between species richness and
food-web structure, plus between species richness and stressors. Finally, we
added the three-way interaction between species richness, food-web structure and
stressors. We added predator interference, predator-prey mass ratio as control
variables. We further added the id of the food-web as a random intercept.  We
then used the linear equation of the model and associated slope coefficients to
predict the shape of the relationship between community stability and species
richness according to a gradient of response diversity and of food-web
structure. To do so, we summed all the coefficients involving species richness
in the model, i.e. the one, two, and three-way terms. The values of the other
variables were set to the values indicated in the Fig. \@ref(fig:pred). The VIF
were inferior to 3, indicating low multicollinearity (Table S3), we checked the
distribution of the residuals (Fig. S3) using `DHARMa` R package. The model was
implemented using the R package `glmmTMB` [@brooks_glmmtmb_2017].


# Results

## Drivers of stability

```{r}
sem_cap <- paste0(
  "Structural Equation Model linking food-web structure and stressors to temporal
  stability of community biomass. a, continuous red arrows display positive and
  dashed blue arrows display negative standardised effects, width of the arrows
  being proportional to the absolute values of the standardised effects. Only
  the standardised coefficients whose absolute values are superior to 0.05 are
  displayed. The full table of coefficients including control variables is
  displayed in Table S4. A more complete SEM containing further partition of
  compensatory effects and control variables is displayed in Table S5. b, total
  effects of food-web structure on community stability, asynchrony, and
  population stability. N = ", nrow(tar_read(sim_fw)), " simulations.") %>%
  str_replace_all("\\s+", " ")
```

```{r sem, fig.cap=sem_cap, fig.id = "sem"}
knitr::include_graphics(here("report", "figures", "p_sem_fig.pdf"))
```


```{r}
tar_load(c(sem_main_text_eff_tab, sem_simplified_eff_tab))

get_eff <- function(
  y = "pop_stab", x = "richness",
  d = 2, effect_type = "direct",
  tab = sem_main_text_eff_tab) {
  mask <- tab$response == y & tab$predictor == x &
    tab$effect_type == effect_type
  round(tab[mask, ]$effect, d)
}

rpt <- get_eff(y = "pop_stab", x = "w_avg_tlvl")
rpc <- get_eff(y = "pop_stab", x = "c")
rpe <- get_eff(y = "pop_stab", x = "env_stoch")
rpd <- get_eff(y = "pop_stab", x = "resp_div")

rsr <- get_eff(y = "sae_total", x = "richness")
rst <- get_eff(y = "sae_total", x = "w_avg_tlvl")
rsi <- get_eff(y = "sae_total", x = "avg_int_strength")
rsc <- get_eff(y = "sae_total", x = "ct_alive")

rcr <- get_eff(y = "cpe", x = "richness")
rci <- get_eff(y = "cpe", x = "avg_int_strength")
rcd <- get_eff(y = "cpe", x = "resp_div")

# Detailled SEM coefficients
rsr <- get_eff(y = "sae_total", x = "richness")
ret <- get_eff(y = "evenness_sae", x = "w_avg_tlvl")
rer <- get_eff(y = "evenness_sae", x = "richness")
rea <- get_eff(y = "evenness_sae", x = "avg_int_strength")
rect <- get_eff(y = "evenness_sae", x = "ct_alive")
rec <- get_eff(y = "evenness_sae", x = "c")
red <- get_eff(y = "evenness_sae", x = "resp_div")

```

```{r, eval = FALSE}
tar_load(c(sem_fig_coeff))
```

We found that food-web structure had significant effects on temporal population
stability such as average trophic level increase population stability (resp.
$r_\delta$= `r rpt`, $r_\delta$ being the standardised coefficient,
Fig. \@ref(fig:sem)a). In turn, the variance of environmental stochasticity had
a strong negative effect on population stability ($r_\delta$= `r rpe`). We
further found that response diversity had a small negative effect on population
stability ($r_\delta$= `r rpd`).


We further found that food-web structure had a strong impact asynchrony, raising
from portfolio and compensatory effects. As
expected the mathematical relationship (eq. \@ref(eq:sae-even)), species
richness was a main positive driver of portfolio effects ($r_\delta$= `r rsr`,
Fig. \@ref(fig:sem)a), thereby increasing
asynchrony. In turn, species richness, average trophic level and connectance had
negative effects on the evenness of species variability (resp. $r_\delta$= `r rer`,
`r ret`, and `r rect`), thereby downplaying the portfolio effect raised from
species richness alone in a scenario of even species variabilities. In turn, we found
that response diversity had a positive effect on evenness of species variability
($r_\delta$=`r red`), thereby maximising the portfolio effect. We found
that species response diversity had a strong positive effect on compensatory
dynamics ($r_\delta$= `r rcd`), while average interaction strength had a small
positive effect ($r_\delta$= `r rci`, Fig. \@ref(fig:sem)).


```{r}

rscp <- get_eff(y = "stab_com", x = "pop_stab")
rsca <- get_eff(y = "stab_com", x = "async")

rac <- get_eff(y = "async", x = "cpe")
ras <- get_eff(y = "async", x = "sae_total")

```

Overall, we found that population stability had a positive effect twice higher
than asynchrony on the temporal stability of community (resp. $r_\delta$=
`r rscp` and `r rsca`). In turn, asynchrony was more driven by compensatory
dynamics than portfolio effects (resp. $r_\delta$= `r rac` and `r ras`, Fig.
\@ref(fig:sem)a).

```{r}
rtsdiv <- get_eff(y = "stab_com", x = "resp_div", effect_type = "total")
rtsenv <- get_eff(y = "stab_com", x = "env_stoch", effect_type = "total")

rtsr <- get_eff(y = "stab_com", x = "richness", effect_type = "total")
rtst <- get_eff(y = "stab_com", x = "w_avg_tlvl", effect_type = "total")
rtsz <- get_eff(y = "stab_com", x = "Z", effect_type = "total")
rtsc <- get_eff(y = "stab_com", x = "c", effect_type = "total")
rtsct <- get_eff(y = "stab_com", x = "ct_alive", effect_type = "total")
rtsi <- get_eff(y = "stab_com", x = "avg_int_strength", effect_type = "total")

rtpr <- get_eff(y = "pop_stab", x = "richness", effect_type = "total")
rtpt <- get_eff(y = "pop_stab", x = "w_avg_tlvl", effect_type = "total")
rtpi <- get_eff(y = "pop_stab", x = "avg_int_strength", effect_type = "total")
rtpz <- get_eff(y = "pop_stab", x = "Z", effect_type = "total")
rtpc <- get_eff(y = "pop_stab", x = "c", effect_type = "total")
rtpct <- get_eff(y = "pop_stab", x = "ct_alive", effect_type = "total")

rtar <- get_eff(y = "async", x = "richness", effect_type = "total")
rtat <- get_eff(y = "async", x = "w_avg_tlvl", effect_type = "total")
rtai <- get_eff(y = "async", x = "avg_int_strength", effect_type = "total")
rtaz <- get_eff(y = "async", x = "Z", effect_type = "total")
rtac <- get_eff(y = "async", x = "c", effect_type = "total")
rtact <- get_eff(y = "async", x = "ct_alive", effect_type = "total")
```

Deriving the sum of direct and indirect effects from the structural equation
model, we show that both environmental stochasticity and species response
diversity to environmental fluctuations had by far the most important effects on
community stability (resp. $r_\delta$= `r rtsenv` and `r rtsdiv`, Fig.
\@ref(fig:sem)b). Species richness had a overall positive total effect on
community stability ($r_\delta$=`r rtsr`), stemming from its strong total positive effect on
asynchrony ($r_\delta$=`r rtar`) and downplayed by its small total negative effect on population
stability ($r_\delta$=`r rtpr`), but population stability effect on community
stability was twice higher than the one of asynchrony. Average trophic level and
average interaction strength had small positive effects on community stability in
total (resp. $r_\delta$=`r rtst`, `r rtsi`, Fig. \@ref(fig:sem)b), driven by their positive
effects on population stability (resp. $r_\delta$=`r rtpt`, `r rtsi`). However,
we found that average trophic level had a negative total effect on asynchrony
($r_\delta$=`r rtat`), average interaction strength had a positive total effect
($r_\delta$=`r rtai`). In turn, connectance had a small negative total effect on
community stability ($r_\delta$=`r rtsct`), raising from a negative total effect
on population stability ($r_\delta$=`r rtpct`) and a positive one on asynchrony
($r_\delta$=`r rtact`, Fig. \@ref(fig:sem)b).


## Stability-richness relationship

```{r}
tar_load(default_variable_values_pred)
pv <- default_variable_values_pred

pv_cap <- paste0(
  "connectance = ", round(pv["ct_alive"], 2),
  ", average interaction strength = ", round(pv["avg_int_strength"], 3),
  ", average trophic level = ", round(pv["w_avg_tlvl"], 2),
  ", predator interference = ", round(pv["c"], 1),
  ", Predator-Prey Mass Ratio = ", round(pv["Z"]),
  ", and environmental stochasticity = ", round(pv["env_stoch"], 1)

)
pred_cap <- paste0("Slope of the community stability - species
  richness relationship according to food-web structure and response diversity. (a),
  Diagrams displaying the slope coefficients of the effect of species richness
  on community stability. The average values of the control variables were used
  to generate the predictions: ", pv_cap, ". (b, c): Examples of predictions
  from the model for two combinations of average trophic level and response
  diversity (values displayed in panel (a)). Lines display the mean predictions
  of the model. The coefficients of the linear model are displayed in Fig. S4.
  Relationships between population stability, asynchrony and species richness
  are displayed in Fig. S5."
  ) %>%
  str_replace_all("\\s+", " ")
```


```{r pred, fig.cap = pred_cap, fig.id = "pred"}
knitr::include_graphics(here("report", "figures", "p_fig3.pdf"))
```

Using a more complex linear model (i.e. including interactions), We found strong
interactions between food-web structure and response diversity on the
relationship between community stability and species richness. We found that
high response diversity almost always leads to positive relationships between
community stability and species richness, no matter the values of average
interaction strength, average trophic level or connectance (Fig.
\@ref(fig:pred)a). Surprisingly, despite the relatively small effects of
food-web structure on overall community stability (Fig. \@ref(fig:sem)b), we
found that response diversity dramatically change the shape of the community
stability-species richness relationship from positive to negative when response
diversity is low (Fig. \@ref(fig:pred)b).

---
#We found that
#environmental stochasticity decrease overall community stability but has only
#little effect on the shape of the community stability-species richness
#relationship (Fig. \@ref(fig:pred)a)
---

```{r, eval = FALSE}
tar_read(p_int_fw_str)
```

# Discussion

One of the key questions in Ecology is what drives temporal stability in complex
communities?, especially in food-webs. We provide an answer to that question by
investigating how the structure of complex food-webs affects the temporal
stability of ecological communities using a bioenergetic model. We added
environmental stochasticity to this model and modulated the species response
diversity, i.e. the capacity of species to answer differently to environmental
fluctuations. We found that food-web structure, apart from species richness,
had little effects on overall stability. However we found that the interplay
between food-web structure and response diversity was critical to determine
positive or negative relationships between community stability and species
richness.

## Food-web structure and stressors affects population stability and asynchrony

Our results show that community stability in complex food-webs is mainly driven
by population stability rather than synchrony, confirming previous results in
empirical fish communities [@danet_species_2021] and theoretical models
[@eschenbrenner_diversity_2023], which contrasts with empirical data in birds
and bats assemblages that reported an equivalent influence of population
stability and asynchrony on community stability [@olivier_urbanization_2020].
Although the number of empirical and theoretical studies is still limited to
compare the respective contribution of asynchrony and population stability to
community stability in single-trophic assemblages and food-webs, we suggest two
non-exclusive and complementary explanations that might drive a lower
contribution of asynchrony in food-webs compared to single-trophic assemblages.
First, the range of bodymasses is much higher in food-webs, which typically
include species that differ in bodymass by several orders of magnitude
[@brose_predator_2019], which in turn creates highly uneven biomass
distribution, thereby creating uneven contributions of species to asynchrony
[@thibaut_understanding_2013] and limits the raise of high portfolio effects and
compensatory dynamics in species rich communities [@zhao_biodiversity_2022].
Second, the trophic interactions characterising food-webs create strong
interdependence among species, which in turn limits the raise of independent
fluctuations (i.e. portfolio effects, but rise compensatory dynamics). The fact
that that compensatory dynamics had stronger effects on asynchrony than
portfolio effects, in contrast with findings in experimental grasslands
[@zhao_biodiversity_2022], lends toward this interpretation. The question of
which mechanisms and community features drive differences in the contribution of
asynchrony and population stability in food-webs and single-trophic assemblages
is still an open question that might be crucial to accurately address
diagnostics and conservation issues. On top of food-web structure, we found that
environmental stochasticity and environmental correlation among species were the
main drivers of community stability, suggesting that stressors are the main
drivers of temporal stability. This result is in accordance with previous
studies showing strong effects of environmental stochasticity
[@vasseur_environmental_2007] and of the loss of response diversity community
stability in tri-trophic food-webs [@ives_stability_2000;
@thebault_trophic_2005].

We further found that average trophic level increased average population
stability, confirming previous theoretical [@brose_allometric_2006;
@shanafelt_stability_2018; @eschenbrenner_diversity_2023] and
[@danet_species_2021] empirical results. Higher average trophic level can
stabilise populations because higher predators are themselves more stable due to
lower mortality rates which in turn makes them less sensible stochastic
perturbation and because they control the amplitude of the fluctuations of their
preys [@shanafelt_stability_2018]. Additional simulations with equal mortality
rates for all species suggest a prevalence of the former explanation (Fig. S1).
In turn, we found that average trophic level decreases strongly asynchrony
through a negative effect on portfolio effects, by decreasing the evenness of
biomass variability. It is linked to the model assumption that species of higher
trophic levels have lower overall mortality rates, similarly to previous
studies [@vasseur_environmental_2007], thereby increasing average population
stability and simultaneously synchronising populations. Furthermore, average
omnivory was strongly correlated with average trophic level (Fig. S2),
suggesting that average omnivory also stabilises population stability, in line
with previous theoretical results in small modules [@mccann_reevaluating_1997].
Our results further suggest that higher average trophic level results in lower
compensatory dynamics raising from species interactions, this results could be
related by the fact that average trophic level is strongly associated with
average omnivory, which might tamper synchronised predator-prey oscillations
that can raise compensatory dynamics [@mccann_reevaluating_1997].

We however found no big effect of species richness on population stability,
which has been reported to be negative, positive or neutral in previous studies
[@ruijven_contrasting_2007; @houlahan_negative_2018]. However, species richness
had a strong positive effect on asynchrony, by raising portfolio effects.
This result is common in empirical systems [@tilman_biodiversity_2006;
@olivier_urbanization_2020; @zhao_biodiversity_2022], but strongly depends on
the presence of response diversity [@loreau_species_2008;
@thibaut_understanding_2013; @zhao_biodiversity_2022]. Connectance, quantifying
the generalism in food-webs, had small negative effects on population
stability but a small positive on on asynchrony. We further found that higher connectance
led to less even biomass variability, thereby limiting the rise of the
portfolio effects, and led to lower compensatory dynamics due to species
interactions (Table. S4). This result is in accordance with empirical findings
that a generalist predator can indeed synchronise the dynamics of a large
number of prey [@raimondo_interspecific_2004], thereby potentially limiting compensatory
dynamics arising from species interactions. However, the overall effect of
connectance on overall stability was quite low, similarly to previous empirical
findings [@danet_species_2021], but in apparent disagreement with the
predominant role of connectance on stability in theoretical studies
[complexity-stability paradox, @may_will_1972].

```{r, eval = FALSE}
tar_load(sem_simplified_eff_tab)
sem_simplified_eff_tab %>%
  filter(effect_type == "total") %>%
  print(n = 100)
```


---
#In turn,
#we found that species richness magnified the effect of the loss of response
#diversity on the compensatory dynamics due to environment. Our interpretation is
#that higher species richness synchronises more species fluctuations due to
#environmental mortality when species are not independent because each added
#species adds (S - 1, S being richness) positive covariance terms in the
#stochastic mortality rates, thereby increasing the overall synchrony in
#mortality rates when cross correlation are not null. This assumption that each
#species are equally correlated to each other seems unlikely to be true but as
#far we know, there is compelling evidence yet for alternative correlation
#structures.
---

Predator interference, taken in this study as a control variable, had also a
strong effect on community stability. Our results confirm the stabilising
effect of self-limiting processes on populations [@uszko_effects_2017;
@brose_allometric_2006]. Furthermore, we found that predator interference
decreased asynchrony by strongly decreasing compensatory effects due to species
interactions. Predator interference models a decrease of the feeding rates of
consumers when predator biomass increases which might lead to a less dramatic
fluctuation of prey biomass. All together, this result suggests that
self-limitation mechanisms that increase population stability might in turn have
opposite effects on asynchrony, and that it is the balance between the two
effects weighted by the relative importance of population stability and
asynchrony that will determine the overall effect on community stability.

## Stability-richness relationship

We found that environmental stochasticity does not affect the shape of the
community stability - richness but rather controls the overall community
stability (i.e. the intercept of the relation). At the opposite, variation in
response diversity had a strong impact on the relationship between stability and
richness. The reason is that the strength of environmental stochasticity mainly
affect population stability and less asynchrony, asynchrony being the driver of
species-richness relationships [@ives_stability_2000; @tilman_biodiversity_2006; @loreau_species_2008;
@thibaut_understanding_2013; @zhao_biodiversity_2022]. Average interaction
strength and connectance that were found to have little effects on overall
stability, were found to have a strong effect on stability-richness
relationships. This result is in accordance with the complexity-stability theory
that predicts that community stability (i.e. measured as the dominant eigen
value of the jacobian matrix) should decrease as the community is species
diverse, has higher connectance, and higher interaction strength
[@may_will_1972]. However, we found that the negative effects of complexity on
stability-richness relationships are cancelled when response diversity is high.
A possible explanation is the presence of response diversity and resulting
asynchrony in species fluctuations which overrides the negative effects of
complexity on stability-richness relationships. Response diversity might then be
one mechanism that explains why positive relationships between stability
and species richness are so prevalent in empirical settings while food-web
theoretical models that do not often include environmental stochasticity and
response diversity finds negative complexity stability relationships
[@ives_stability_2007].

# Conclusion and perspectives

Our study presents the effects of food-web structure on temporal community
stability and its partition into population stability and asynchrony in complex
communities, added to two pressing stressors in the context of global change,
the strength of environmental variability and the level of response diversity of
species facing this environmental variability. Our results confirm the results
of previous theoretical models modelling small food-web modules or food-chains,
as we report that average trophic level, omnivory, predator-prey size ratio, and
predator interference increase temporal community stability by stabilising
population fluctuations. In turn, our study confirms that species richness
increases temporal community stability by increasing asynchrony due to portfolio
effects and thanks to response diversity. Our study reports that connectance and
average interaction strength have little effects on overall community stability
while they have a strong effect on the sign of the community stability-richness
relationship, in accordance with the complexity-stability paradox, modulated by
response diversity. Overall, it suggests that high response diversity of species
facing environmental stochasticity, on top of being the essential ingredient
driving positive stability-richness relationship, also exceeds the negative
effects of food-web complexity on stability-richness relationship.

Our results highlight that the strength of environmental fluctuations is the
primary driver of community stability. In the context of global changes in which
environmental variability is expected to increase tremendously, our study
suggests a strong decrease in community stability, despite high response
diversity and response diversity. But ongoing biotic homogenization
[@olden_homogocene_2018; @muthukrishnan_invasive_2020; @wang_biotic_2021] is
also suggested to decrease response diversity [@wang_biotic_2021;
@su_human_2021], which in turn is expected to further decrease stability despite
high species richness, even more in complex food-webs having high interaction
strength, high connectance and high average trophic level. Then, the results of
our study reinforce the idea that restoration of ecosystems along with a
restoration of landscape complexity that provides refuges from extreme
environmental fluctuations will be key to maintain temporal stability of
ecological communities in the coming decades [@ryser_landscape_2021].

# References {-}
